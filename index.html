<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OceanPlan - Evaluasi Perkuliahan</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: fade-in-up 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- KONFIGURASI REMOTE BACKEND ---
        // Masukkan URL Vercel dari repo private kamu di sini
        const BACKEND_URL = "https://rahasia-iseng2.vercel.app/api/chat"; 

        const TARGET_SKS_LULUS = 144;
        const TARGET_SKS_WAJIB = 100;
        const TARGET_SKS_PILIHAN = 44;
        const MAX_SKS_ABSOLUTE = 24;

        // --- API CALL CONFIG ---
        const askGemini = async (userQuery, systemPrompt, chatHistory = []) => {
            const contents = chatHistory.map(msg => ({
                role: msg.role === 'user' ? 'user' : 'model',
                parts: [{ text: msg.text }]
            }));
            contents.push({ role: 'user', parts: [{ text: userQuery }] });
            const payload = { contents, systemInstruction: { parts: [{ text: systemPrompt }] } };

            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error("Gagal akses backend");
                const result = await response.json();
                // Pastikan ada tanda tanya (?) untuk mencegah error jika data kosong
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, ada masalah pada response AI.";            } catch (error) {
                return "Koneksi asisten AI bermasalah. Pastikan API di repo private sudah aktif.";
            }
        };

        // --- ICON HELPER ---
        const Icon = ({ icon, size = 20, className = "" }) => {
            if (!icon) return null;
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                  {icon.map(([tag, attrs], index) => React.createElement(tag, { ...attrs, key: index }))}
                </svg>
            );
        };

        const Icons = {
            BookOpen: lucide.icons.BookOpen, Target: lucide.icons.Target, Brain: lucide.icons.Brain,
            Save: lucide.icons.Save, BarChart3: lucide.icons.BarChart3, Database: lucide.icons.Database,
            MessageSquare: lucide.icons.MessageSquare, Send: lucide.icons.Send, RotateCcw: lucide.icons.RotateCcw,
            Moon: lucide.icons.Moon, Sun: lucide.icons.Sun, Mail: lucide.icons.Mail, X: lucide.icons.X,
            ArrowRightLeft: lucide.icons.ArrowRightLeft, Info: lucide.icons.Info, Plus: lucide.icons.Plus,
            CheckCircle: lucide.icons.CheckCircle, Award: lucide.icons.Award, Zap: lucide.icons.Zap,
            Minus: lucide.icons.Minus, Sparkles: lucide.icons.Sparkles, Bot: lucide.icons.Bot,
            TrendingUp: lucide.icons.TrendingUp, PieChart: lucide.icons.PieChart, AlertTriangle: lucide.icons.AlertTriangle,
            Unlock: lucide.icons.Unlock
        };

        const GRADES = { 'A': 4.0, 'AB': 3.5, 'B': 3.0, 'BC': 2.5, 'C': 2.0, 'D': 1.0, 'E': 0.0, 'T': 0.0 };
        
        const SPECIALIZATIONS = [
            { id: 'offshore', name: 'Struktur Bangunan Lepas Pantai', required: ['KL4101', 'KL4102'], desc: 'Fokus pada desain anjungan minyak & gas.' },
            { id: 'coastal', name: 'Rekayasa & Perlindungan Pantai', required: ['KL4201', 'KL3202'], desc: 'Penanganan abrasi, reklamasi, dan tembok laut.' },
            { id: 'port', name: 'Pelabuhan & Transportasi Laut', required: ['KL4105', 'KL4205'], desc: 'Perencanaan dermaga dan logistik maritim.' },
            { id: 'ocean_modelling', name: 'Pemodelan & Hidrodinamika', required: ['KL4202', 'KL2205'], desc: 'Simulasi arus, gelombang, dan tsunami.' },
            { id: 'geotech', name: 'Geoteknik Kelautan', required: ['KL3103', 'KL3204'], desc: 'Kestabilan dasar laut, pondasi, dan pengerukan.' },
            { id: 'environment', name: 'Lingkungan Laut', required: ['KL4110'], desc: 'AMDAL, polusi laut, dan konservasi.' },
            { id: 'energy', name: 'Energi Laut Terbarukan', required: ['KL4108', 'KL4208'], desc: 'Pembangkit listrik tenaga arus/gelombang.' },
            { id: 'acoustics', name: 'Akustik Bawah Air', required: ['KL3104'], desc: 'Sonar, pemetaan dasar laut, dan instrumentasi.' },
        ];

        const CURRICULUM_DB = [
            { code: 'MA1101', name: 'Matematika IA', sks: 4, semester: 1, type: 'Wajib', prereq: [] },
            { code: 'FI1101', name: 'Fisika Dasar IA', sks: 4, semester: 1, type: 'Wajib', prereq: [] },
            { code: 'KI1101', name: 'Kimia Dasar IA', sks: 3, semester: 1, type: 'Wajib', prereq: [] },
            { code: 'KU1102', name: 'Pengenalan Komputasi', sks: 3, semester: 1, type: 'Wajib', prereq: [] },
            { code: 'KU1011', name: 'Tata Tulis Karya Ilmiah', sks: 2, semester: 1, type: 'Wajib', prereq: [] },
            { code: 'MA1201', name: 'Matematika IIA', sks: 4, semester: 2, type: 'Wajib', prereq: ['MA1101'] },
            { code: 'FI1201', name: 'Fisika Dasar IIA', sks: 4, semester: 2, type: 'Wajib', prereq: ['FI1101'] },
            { code: 'KI1201', name: 'Kimia Dasar IIA', sks: 3, semester: 2, type: 'Wajib', prereq: ['KI1101'] },
            { code: 'KU1202', name: 'Pengantar Rekayasa & Desain', sks: 2, semester: 2, type: 'Wajib', prereq: [] },
            { code: 'KU1024', name: 'Bahasa Inggris', sks: 2, semester: 2, type: 'Wajib', prereq: [] },
            { code: 'KL2101', name: 'Matematika Teknik I', sks: 3, semester: 3, type: 'Wajib', prereq: ['MA1201'] },
            { code: 'KL2102', name: 'Mekanika Fluida', sks: 4, semester: 3, type: 'Wajib', prereq: ['FI1101'] },
            { code: 'KL2103', name: 'Statika Struktur', sks: 3, semester: 3, type: 'Wajib', prereq: ['FI1101'] },
            { code: 'KL2104', name: 'Geologi Laut', sks: 2, semester: 3, type: 'Wajib', prereq: [] },
            { code: 'KL2105', name: 'Material Laut & Korosi', sks: 2, semester: 3, type: 'Wajib', prereq: ['KI1101'] },
            { code: 'KL2201', name: 'Matematika Teknik II', sks: 3, semester: 4, type: 'Wajib', prereq: ['KL2101'] },
            { code: 'KL2202', name: 'Hidrodinamika', sks: 3, semester: 4, type: 'Wajib', prereq: ['KL2102'] },
            { code: 'KL2203', name: 'Mekanika Material', sks: 3, semester: 4, type: 'Wajib', prereq: ['KL2103'] },
            { code: 'KL2204', name: 'Oseanografi Fisik', sks: 3, semester: 4, type: 'Wajib', prereq: ['MA1201'] },
            { code: 'KL2205', name: 'Metode Numerik Kelautan', sks: 2, semester: 4, type: 'Wajib', prereq: ['KU1102'] },
            { code: 'KL3101', name: 'Analisis Struktur Metode Matriks', sks: 3, semester: 5, type: 'Wajib', prereq: ['KL2203'] },
            { code: 'KL3102', name: 'Gelombang Laut', sks: 3, semester: 5, type: 'Wajib', prereq: ['KL2202'] },
            { code: 'KL3103', name: 'Mekanika Tanah Laut', sks: 3, semester: 5, type: 'Wajib', prereq: [] },
            { code: 'KL3104', name: 'Dinamika Struktur', sks: 3, semester: 5, type: 'Wajib', prereq: ['KL2103', 'KL2101'] },
            { code: 'KL3001', name: 'Probabilitas & Statistik Kelautan', sks: 2, semester: 5, type: 'Wajib', flex: true, prereq: ['MA1201'] },
            { code: 'KL3201', name: 'Desain Struktur Baja', sks: 3, semester: 6, type: 'Wajib', prereq: ['KL3101'] },
            { code: 'KL3202', name: 'Bangunan Pantai', sks: 3, semester: 6, type: 'Wajib', prereq: ['KL3102'] },
            { code: 'KL3203', name: 'Desain Struktur Beton', sks: 3, semester: 6, type: 'Wajib', prereq: ['KL3101'] },
            { code: 'KL3204', name: 'Pondasi Laut', sks: 2, semester: 6, type: 'Wajib', prereq: ['KL3103'] },
            { code: 'KL4101', name: 'Dinamika Struktur Lepas Pantai', sks: 3, semester: 7, type: 'Pilihan', prereq: ['KL3104'] },
            { code: 'KL4201', name: 'Manajemen Pesisir', sks: 3, semester: 7, type: 'Pilihan', prereq: [] },
            { code: 'KL4105', name: 'Perencanaan Pelabuhan', sks: 3, semester: 7, type: 'Pilihan', prereq: ['KL3202'] },
            { code: 'KL4108', name: 'Energi Arus Laut', sks: 3, semester: 7, type: 'Pilihan', prereq: ['KL3102'] },
            { code: 'KL4110', name: 'Lingkungan Laut & Pengerukan', sks: 3, semester: 7, type: 'Pilihan', prereq: [] },
            { code: 'KL4090', name: 'Kerja Praktek', sks: 2, semester: 7, type: 'Wajib', prereq: ['KL3101', 'KL3102'] },
            { code: 'KL4098', name: 'Tugas Akhir I (Proposal)', sks: 2, semester: 7, type: 'Wajib', prereq: ['KL4090'] },
            { code: 'KL4102', name: 'Desain Anjungan Lepas Pantai', sks: 3, semester: 8, type: 'Pilihan', prereq: ['KL4101'] },
            { code: 'KL4202', name: 'Model Numerik Pantai', sks: 3, semester: 8, type: 'Pilihan', prereq: ['KL3202'] },
            { code: 'KL4205', name: 'Operasional Pelabuhan', sks: 3, semester: 8, type: 'Pilihan', prereq: ['KL4105'] },
            { code: 'KL4208', name: 'Sistem Konversi Energi Laut', sks: 3, semester: 8, type: 'Pilihan', prereq: ['KL4108'] },
            { code: 'KL4099', name: 'Tugas Akhir II (Sidang)', sks: 4, semester: 8, type: 'Wajib', prereq: ['KL4098'] },
        ];

        // --- UI COMPONENTS ---
        const ProgressBar = ({ label, current, max, colorClass, darkMode }) => (
            <div className="mb-4">
                <div className="flex justify-between text-xs mb-1">
                    <span className={darkMode ? 'text-slate-300' : 'text-slate-600'}>{label}</span>
                    <span className={`font-bold ${darkMode ? 'text-slate-200' : 'text-slate-800'}`}>{current} / {max} SKS</span>
                </div>
                <div className={`w-full h-2.5 rounded-full ${darkMode ? 'bg-slate-700' : 'bg-slate-200'}`}>
                    <div className={`h-full rounded-full transition-all duration-700 ${colorClass}`} style={{ width: `${Math.min((current/max)*100, 100)}%` }}></div>
                </div>
            </div>
        );

        const SimpleLineChart = ({ data, darkMode }) => {
            if (!data || data.length === 0) return null;
            const height = 100; const width = 300; const maxVal = 4.0;
            const points = data.map((d, i) => {
                const x = (i / (data.length - 1 || 1)) * width;
                const y = height - (d.nr / maxVal) * height;
                return `${x},${y}`;
            }).join(' ');
            const gridColor = darkMode ? "#334155" : "#e2e8f0"; 
            const lineColor = "#6366f1"; 
            return (
                <div className="w-full h-32 relative">
                    <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full overflow-visible">
                        <line x1="0" y1={height*0.25} x2={width} y2={height*0.25} stroke={gridColor} strokeDasharray="4" />
                        <line x1="0" y1={height*0.5} x2={width} y2={height*0.5} stroke={gridColor} strokeDasharray="4" />
                        <line x1="0" y1={height*0.75} x2={width} y2={height*0.75} stroke={gridColor} strokeDasharray="4" />
                        <polyline points={points} fill="none" stroke={lineColor} strokeWidth="3" strokeLinecap="round" />
                        {data.map((d, i) => (<circle key={i} cx={(i / (data.length - 1 || 1)) * width} cy={height - (d.nr / maxVal) * height} r="4" fill={darkMode ? "#1e293b" : "white"} stroke={lineColor} strokeWidth="2" />))}
                    </svg>
                </div>
            );
        };

        const Card = ({ children, className = "", darkMode }) => (
            <div className={`rounded-3xl border shadow-sm transition-colors ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'} ${className}`}>{children}</div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [darkMode, setDarkMode] = useState(false);
            const [history, setHistory] = useState({});
            const [movedCourses, setMovedCourses] = useState({});
            const [retakePlan, setRetakePlan] = useState({});
            const [retakeGrades, setRetakeGrades] = useState({});
            const [plannerSelection, setPlannerSelection] = useState([]);
            const [profile, setProfile] = useState({ name: 'Mahasiswa', currentSemester: 4, targetSpecializations: ['offshore', 'coastal'] });
            const [messages, setMessages] = useState([{ role: 'ai', text: 'Halo! Saya OceanAI Assistant. Saya bisa membantumu mengevaluasi kurikulum Teknik Kelautan.' }]);
            const [chatInput, setChatInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [showElectiveModal, setShowElectiveModal] = useState(null);
            const [plannerMode, setPlannerMode] = useState('recommendation');
            const [alert, setAlert] = useState(null);
            const chatEndRef = useRef(null);

            // --- HELPER LOGIC ---
            const getCourseSemester = (course) => movedCourses[course.code] !== undefined ? movedCourses[course.code] : course.semester;
            const isSpecializationCourse = (code) => SPECIALIZATIONS.some(s => s.required.includes(code));
            const getSpecName = (code) => {
                const found = SPECIALIZATIONS.filter(s => s.required.includes(code));
                return found.length > 0 ? found.map(s => s.name.split(' ')[0]).join(', ') : null;
            };

            const semesterStats = useMemo(() => {
                const sbs = {}; [1, 2, 3, 4, 5, 6, 7, 8].forEach(s => sbs[s] = { totalSks: 0, totalPoints: 0, nr: 0, count: 0, retakeSks: 0 });
                let sw = 0; let sp = 0;
                CURRICULUM_DB.forEach(c => {
                    const es = getCourseSemester(c); const g = history[c.code];
                    if (g && GRADES[g] >= 2.0) { if (c.type === 'Wajib') sw += c.sks; else sp += c.sks; }
                    if (es >= 1 && es <= 8 && g && GRADES[g] !== undefined) { sbs[es].totalSks += c.sks; sbs[es].totalPoints += (c.sks * GRADES[g]); sbs[es].count += 1; }
                });
                Object.entries(retakePlan).forEach(([code, ts]) => {
                    const c = CURRICULUM_DB.find(x => x.code === code); const pg = retakeGrades[code];
                    if (c && sbs[ts]) { sbs[ts].retakeSks += c.sks; if (pg && GRADES[pg] !== undefined) { sbs[ts].totalSks += c.sks; sbs[ts].totalPoints += (c.sks * GRADES[pg]); sbs[ts].count += 1; } }
                });
                const gd = []; let cp = 0; let cs = 0;
                [1, 2, 3, 4, 5, 6, 7, 8].forEach(s => {
                    const st = sbs[s]; if (st.totalSks > 0) { st.nr = st.totalPoints / st.totalSks; cp += st.totalPoints; cs += st.totalSks; if (s <= profile.currentSemester || st.count > 0) gd.push({ sem: s, nr: st.nr }); }
                });
                return { bySem: sbs, graphData: gd, ipk: cs > 0 ? (cp/cs).toFixed(2) : "0.00", totalSks: cs, sksLulusWajib: sw, sksLulusPilihan: sp };
            }, [history, profile.currentSemester, movedCourses, retakePlan, retakeGrades]);

            const recommendedCourses = useMemo(() => {
                return CURRICULUM_DB.filter(c => {
                    const g = history[c.code];
                    if (g && GRADES[g] >= 2.0) return false;
                    return c.prereq.every(p => history[p] && GRADES[history[p]] >= 1.0);
                }).sort((a, b) => {
                    const isSpecA = isSpecializationCourse(a.code) ? 1 : 0;
                    const isSpecB = isSpecializationCourse(b.code) ? 1 : 0;
                    return isSpecB - isSpecA;
                });
            }, [history]);

            const coachFeedback = useMemo(() => {
                const msgs = [];
                const currentMandatory = CURRICULUM_DB.filter(c => c.type === 'Wajib' && getCourseSemester(c) === profile.currentSemester);
                const missing = currentMandatory.filter(c => !plannerSelection.includes(c.code) && (!history[c.code] || GRADES[history[c.code]] < 2.0));
                if (missing.length > 0) msgs.push(`ðŸ”´ Hati-hati! Matkul Wajib ${missing.map(m=>m.code).join(', ')} belum masuk rencana studimu.`);
                const overSks = plannerSelection.reduce((a,c) => a + (CURRICULUM_DB.find(x=>x.code===c)?.sks || 0), 0);
                if (overSks > 24) msgs.push(`âš ï¸ Beban SKS (${overSks}) melebihi batas maksimal 24 SKS!`);
                return msgs;
            }, [plannerSelection, profile.currentSemester, history, movedCourses]);

            // --- FUNCTIONS (FIXED) ---
            const showAlert = (msg) => { setAlert(msg); setTimeout(() => setAlert(null), 3000); };

            const getSemesterLoad = (sem) => {
                const rl = CURRICULUM_DB.filter(c => getCourseSemester(c) === sem).reduce((a, cu) => a + cu.sks, 0);
                const rtl = Object.entries(retakePlan).filter(([_, t]) => t === sem).map(([c, _]) => CURRICULUM_DB.find(x => x.code === c)).reduce((a, cu) => a + (cu ? cu.sks : 0), 0);
                return rl + rtl;
            };

            const autoFillPreviousSemesters = () => {
                const nh = { ...history };
                CURRICULUM_DB.forEach(c => {
                    const s = getCourseSemester(c);
                    if (s < profile.currentSemester && !nh[c.code]) nh[c.code] = 'B';
                });
                setHistory(nh);
            };

            const moveCourse = (cc, ns) => {
                const c = CURRICULUM_DB.find(x => x.code === cc);
                if (getSemesterLoad(ns) + c.sks > MAX_SKS_ABSOLUTE) return showAlert(`Gagal! Sem ${ns} penuh.`);
                setMovedCourses(p => ({...p, [cc]: parseInt(ns)}));
                setShowElectiveModal(null);
            };

            const planRetake = (cc, ts) => {
                const c = CURRICULUM_DB.find(x => x.code === cc);
                if (getSemesterLoad(ts) + c.sks > MAX_SKS_ABSOLUTE) return showAlert(`Gagal! Sem ${ts} penuh.`);
                setRetakePlan(p => ({...p, [cc]: parseInt(ts)}));
            };

            const cancelRetake = (cc) => {
                setRetakePlan(p => { const n = {...p}; delete n[cc]; return n; });
                setRetakeGrades(p => { const n = {...p}; delete n[cc]; return n; });
            };

            const handleSendMessage = async () => {
                if (!chatInput.trim()) return;
                const ut = chatInput; setMessages(prev => [...prev, { role: 'user', text: ut }]); setChatInput(''); setIsTyping(true);
                const sp = `Asisten OceanAI. Mahasiswa: ${profile.name}, Sem: ${profile.currentSemester}, IPK: ${semesterStats.ipk}. Kurikulum: ${JSON.stringify(CURRICULUM_DB)}.`;
                const aiR = await askGemini(ut, sp, messages);
                setMessages(prev => [...prev, { role: 'ai', text: aiR }]); setIsTyping(false);
            };

            useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages, isTyping]);

            return (
                <div className={`min-h-screen font-sans transition-colors duration-500 ${darkMode ? 'bg-slate-950 text-slate-100' : 'bg-slate-50 text-slate-900'}`}>
                    {alert && (<div className="fixed top-24 right-4 z-[100] bg-red-600 text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-3 animate-in"><Icon icon={Icons.AlertTriangle} /><b>{alert}</b></div>)}
                    <header className={`sticky top-0 z-50 border-b p-4 flex justify-between items-center backdrop-blur-md ${darkMode ? 'bg-slate-900/80 border-slate-800' : 'bg-white/80 border-slate-200'}`}>
                        <div className="flex items-center gap-3"><div className="bg-indigo-600 text-white p-2 rounded-2xl shadow-lg"><Icon icon={Icons.BookOpen} size={24} /></div><h1 className="font-extrabold text-2xl tracking-tighter">Ocean<span className="text-indigo-600">Plan</span></h1></div>
                        <button onClick={() => setDarkMode(!darkMode)} className="p-3 rounded-2xl bg-slate-100 dark:bg-slate-800 hover:scale-105 active:scale-95 transition-all">{darkMode ? <Icon icon={Icons.Sun} className="text-yellow-400" /> : <Icon icon={Icons.Moon} />}</button>
                    </header>

                    <nav className="max-w-5xl mx-auto p-4 flex gap-2 overflow-x-auto scrollbar-hide mt-4">
                        {[
                            { id: 'dashboard', label: 'Dashboard', icon: Icons.BarChart3 },
                            { id: 'input', label: 'Transkrip', icon: Icons.Save },
                            { id: 'planner', label: 'Strategi', icon: Icons.Target },
                            { id: 'library', label: 'Library', icon: Icons.Database },
                            { id: 'assistant', label: 'Assistant', icon: Icons.MessageSquare }
                        ].map(tab => (
                            <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`px-6 py-2.5 rounded-full flex items-center gap-2 transition-all font-semibold ${activeTab === tab.id ? 'bg-indigo-600 text-white shadow-xl scale-105' : 'bg-white dark:bg-slate-900 border'}`}>
                                <Icon icon={tab.icon} size={18} /> {tab.label}
                            </button>
                        ))}
                    </nav>

                    <main className="max-w-5xl mx-auto p-4 space-y-8 pb-20">
                        {/* DASHBOARD */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8 animate-in">
                                <Card darkMode={darkMode} className="p-8 flex flex-col md:flex-row justify-between items-center gap-6 bg-gradient-to-br from-indigo-50 to-white dark:from-slate-900 dark:to-slate-800">
                                    <div className="flex items-center gap-4"><div className="w-16 h-16 rounded-3xl bg-indigo-600 flex items-center justify-center text-white shadow-xl"><Icon icon={Icons.Brain} size={32} /></div><div><h2 className="text-3xl font-black">Halo, {profile.name}!</h2><p className="opacity-60 font-medium">Status Semester: {profile.currentSemester} &bull; IPK: <span className="text-indigo-600 font-bold">{semesterStats.ipk}</span></p></div></div>
                                    <div className="flex gap-4"><div className="bg-white dark:bg-slate-800 p-4 rounded-3xl border shadow-sm text-center min-w-[120px]"><p className="text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-1">SKS Lulus</p><p className="text-3xl font-black">{semesterStats.totalSks}</p></div></div>
                                </Card>
                                <div className="grid md:grid-cols-3 gap-8">
                                    <Card darkMode={darkMode} className="md:col-span-2 p-8"><h3 className="text-xl font-bold mb-6 flex items-center gap-2"><Icon icon={Icons.TrendingUp} className="text-indigo-500"/>Perkembangan Indeks Prestasi</h3><SimpleLineChart data={semesterStats.graphData} darkMode={darkMode} /></Card>
                                    <Card darkMode={darkMode} className="p-8"><h3 className="text-xl font-bold mb-6 flex items-center gap-2"><Icon icon={Icons.PieChart} className="text-indigo-500"/>Target Kelulusan</h3><ProgressBar label="Total Kelulusan" current={semesterStats.totalSks} max={TARGET_SKS_LULUS} colorClass="bg-indigo-600" darkMode={darkMode} /><ProgressBar label="Matkul Wajib" current={semesterStats.sksLulusWajib} max={TARGET_SKS_WAJIB} colorClass="bg-emerald-500" darkMode={darkMode} /><ProgressBar label="Matkul Pilihan" current={semesterStats.sksLulusPilihan} max={TARGET_SKS_PILIHAN} colorClass="bg-amber-500" darkMode={darkMode} /></Card>
                                </div>
                            </div>
                        )}

                        {/* TRANSKRIP */}
                        {activeTab === 'input' && (
                            <div className="space-y-8 animate-in">
                                <div className="bg-blue-600 p-6 rounded-3xl text-white shadow-xl flex justify-between items-center">
                                    <div><h2 className="text-xl font-bold">Input Transkrip Nilai</h2><p className="opacity-80 text-sm">Update nilai semester lalu untuk kalkulasi AI.</p></div>
                                    <button onClick={autoFillPreviousSemesters} className="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-2xl text-xs font-bold border border-white/30">Auto-Fill Lulus</button>
                                </div>
                                <div className="grid md:grid-cols-2 gap-8">
                                    {[1, 2, 3, 4, 5, 6, 7, 8].map(s => {
                                        const courses = CURRICULUM_DB.filter(c => getCourseSemester(c) === s);
                                        const rPlan = Object.entries(retakePlan).filter(([_, ts]) => ts === s).map(([code, _]) => CURRICULUM_DB.find(x => x.code === code));
                                        return (
                                            <Card key={s} darkMode={darkMode} className="overflow-hidden">
                                                <div className="p-5 border-b flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50"><h3 className="font-black text-lg">Semester {s}</h3><button onClick={() => setShowElectiveModal(s)} className="text-[10px] bg-indigo-100 text-indigo-600 px-3 py-1.5 rounded-full font-black flex items-center gap-1 hover:bg-indigo-600 hover:text-white transition-all"><Icon icon={Icons.Plus} size={12}/> AMBIL PILIHAN</button></div>
                                                <div className="divide-y dark:divide-slate-800">
                                                    {courses.map(c => {
                                                        const isFailed = history[c.code] && GRADES[history[c.code]] < 2.0;
                                                        return (
                                                            <div key={c.code} className={`p-5 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800/30 transition-all ${isFailed ? 'bg-red-50/30' : ''}`}>
                                                                <div className="flex-1">
                                                                    <div className="flex items-center gap-2"><span className="font-mono text-[10px] opacity-40">{c.code}</span>{isFailed && <button onClick={() => planRetake(c.code, s + 1)} className="text-red-500 font-bold text-[9px] border border-red-200 px-1 rounded hover:bg-red-500 hover:text-white"><Icon icon={Icons.RotateCcw} size={10} className="inline mr-1"/>ULANG</button>}</div>
                                                                    <span className="font-bold text-sm block">{c.name}</span>
                                                                </div>
                                                                <select value={history[c.code] || ""} onChange={(e) => setHistory({...history, [c.code]: e.target.value})} className={`p-2 rounded-2xl border text-xs font-black outline-none focus:ring-2 focus:ring-indigo-500 ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white'}`}><option value="">NILAI</option>{Object.keys(GRADES).map(g => <option key={g} value={g}>{g}</option>)}</select>
                                                            </div>
                                                        );
                                                    })}
                                                    {rPlan.map(c => (
                                                        <div key={`retake-${c.code}`} className="p-5 flex justify-between items-center bg-indigo-50/30 dark:bg-indigo-900/10 border-l-4 border-indigo-500">
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-2"><span className="font-mono text-[10px] opacity-40">{c.code}</span><span className="text-indigo-600 font-black text-[9px] uppercase tracking-tighter">Retake Plan</span></div>
                                                                <span className="font-bold text-sm block">{c.name}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <select value={retakeGrades[c.code] || ""} onChange={(e) => setRetakeGrades({...retakeGrades, [c.code]: e.target.value})} className="p-2 rounded-xl border text-xs font-black text-indigo-700"><option value="">TARGET</option>{Object.keys(GRADES).map(g => <option key={g} value={g}>{g}</option>)}</select>
                                                                <button onClick={() => cancelRetake(c.code)} className="p-2 text-slate-400 hover:text-red-500"><Icon icon={Icons.X} size={14}/></button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </Card>
                                        );
                                    })}
                                </div>
                                {showElectiveModal && (
                                    <div className="fixed inset-0 z-[100] bg-slate-950/60 backdrop-blur-sm flex items-center justify-center p-6">
                                        <Card darkMode={darkMode} className="max-w-xl w-full p-8 animate-in"><div className="flex justify-between items-center mb-6"><h4 className="text-xl font-black">Pilih Mata Kuliah Pilihan</h4><button onClick={() => setShowElectiveModal(null)} className="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-2xl"><Icon icon={Icons.X}/></button></div><div className="space-y-3 max-h-96 overflow-y-auto pr-4 scrollbar-hide">{CURRICULUM_DB.filter(c => !history[c.code] && getCourseSemester(c) !== showElectiveModal).map(c => (<button key={c.code} onClick={() => moveCourse(c.code, showElectiveModal)} className="w-full text-left p-4 border rounded-3xl hover:border-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 group transition-all flex justify-between items-center"><div><p className="font-mono text-[10px] opacity-40">{c.code}</p><p className="font-bold group-hover:text-indigo-600">{c.name}</p></div><span className="bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-full text-[10px] font-black">{c.sks} SKS</span></button>))}</div></Card>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* PLANNER */}
                        {activeTab === 'planner' && (
                            <div className="space-y-8 animate-in">
                                <div className="bg-slate-900 text-white p-8 rounded-[40px] shadow-2xl relative overflow-hidden"><div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-6"><div className="max-w-xl"><h2 className="text-4xl font-black mb-3 flex items-center gap-3"><Icon icon={Icons.Target} size={40} className="text-indigo-400" /> Interactive Strategist</h2><p className="opacity-60 text-lg">Bangun rencana studi custom. AI Coach akan memberikan feedback real-time.</p></div><div className="flex bg-white/10 p-1.5 rounded-2xl border border-white/20"><button onClick={() => setPlannerMode('recommendation')} className={`px-5 py-2 rounded-xl text-sm font-bold transition-all ${plannerMode === 'recommendation' ? 'bg-white text-indigo-900 shadow-lg' : 'hover:bg-white/10'}`}>AI Smart</button><button onClick={() => setPlannerMode('catalog')} className={`px-5 py-2 rounded-xl text-sm font-bold transition-all ${plannerMode === 'catalog' ? 'bg-white text-indigo-900 shadow-lg' : 'hover:bg-white/10'}`}>Katalog</button></div></div></div>
                                {coachFeedback.length > 0 && (<Card darkMode={darkMode} className="p-6 border-l-[8px] border-l-amber-500 bg-amber-50/30 dark:bg-amber-900/10"><h3 className="font-black text-amber-600 mb-3 flex items-center gap-2"><Icon icon={Icons.Bot}/> Coach Feedback:</h3><div className="space-y-2">{coachFeedback.map((msg, i) => <p key={i} className="text-sm font-bold opacity-80">&bull; {msg}</p>)}</div></Card>)}
                                <div className="grid md:grid-cols-2 gap-8 h-[650px]">
                                    <div className="flex flex-col gap-4 overflow-hidden"><h3 className="font-black text-xl flex items-center gap-2 px-2"><Icon icon={Icons.Sparkles} className="text-emerald-500"/> Ambil Mata Kuliah</h3><div className="flex-1 overflow-y-auto space-y-3 pr-4 scrollbar-hide">{(plannerMode === 'recommendation' ? recommendedCourses : CURRICULUM_DB.filter(c => !history[c.code] || GRADES[history[c.code]] < 2.0)).filter(c => !plannerSelection.includes(c.code)).map(c => { const spec = getSpecName(c.code); const isWajib = c.type === 'Wajib' && getCourseSemester(c) === profile.currentSemester; return (<div key={c.code} className={`p-5 border rounded-[30px] flex justify-between items-center transition-all hover:scale-[1.02] ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'} ${isWajib ? 'ring-2 ring-red-500' : ''}`}><div className="flex-1"><div className="flex items-center gap-2 mb-1">{isWajib && <span className="text-[9px] bg-red-500 text-white px-2 py-0.5 rounded-full font-black">WAJIB</span>}<h5 className="font-black text-sm">{c.name}</h5></div><p className="text-[10px] opacity-50 font-bold">{c.code} &bull; SEM {c.semester} &bull; {c.sks} SKS</p>{spec && <p className="text-[9px] mt-2 text-indigo-500 font-bold flex items-center gap-1"><Icon icon={Icons.Zap} size={10}/> Irisan: {spec}</p>}</div><button onClick={() => setPlannerSelection([...plannerSelection, c.code])} className="p-3 bg-indigo-600 text-white rounded-2xl hover:rotate-90 transition-all"><Icon icon={Icons.Plus} size={18}/></button></div>); })}</div></div>
                                    <div className="flex flex-col gap-4 overflow-hidden"><div className="flex justify-between items-center px-2"><h3 className="font-black text-xl flex items-center gap-2"><Icon icon={Icons.CheckCircle} className="text-indigo-600"/> Draft Rencanamu</h3><span className="px-4 py-1 bg-indigo-100 text-indigo-600 rounded-full font-black text-xs">{plannerSelection.reduce((a,c) => a + (CURRICULUM_DB.find(x=>x.code===c)?.sks || 0), 0)} SKS</span></div><div className={`flex-1 rounded-[40px] p-6 overflow-y-auto space-y-4 border-2 border-dashed ${darkMode ? 'bg-slate-900/50 border-slate-800' : 'bg-slate-100 border-slate-300'}`}>{plannerSelection.length === 0 && <div className="h-full flex flex-col items-center justify-center opacity-10 text-center"><Icon icon={Icons.Target} size={100}/><p className="font-black text-xl uppercase">Draft Kosong</p></div>}{plannerSelection.map(cc => { const c = CURRICULUM_DB.find(x => x.code === cc); return (<div key={cc} className="p-5 bg-white dark:bg-slate-800 border-2 border-indigo-100 dark:border-indigo-900 rounded-3xl flex justify-between items-center animate-in shadow-sm"><div><h5 className="font-black text-sm">{c.name}</h5><p className="text-[10px] opacity-40 font-bold">{c.code} &bull; {c.sks} SKS</p></div><button onClick={() => setPlannerSelection(plannerSelection.filter(x => x !== cc))} className="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all"><Icon icon={Icons.Minus}/></button></div>); })}</div></div>
                                </div>
                            </div>
                        )}

                        {/* LIBRARY */}
                        {activeTab === 'library' && (
                            <div className="space-y-12 animate-in">
                                <div className="bg-indigo-600 p-10 rounded-[40px] text-white shadow-2xl relative overflow-hidden"><div className="relative z-10"><h2 className="text-4xl font-black mb-3">Direktori Kurikulum</h2><p className="opacity-70 text-lg max-w-2xl font-medium">Database lengkap mata kuliah Teknik Kelautan. Klik untuk melihat prasyarat dan spesialisasi.</p><div className="mt-8 flex flex-wrap gap-4 text-xs font-black tracking-widest"><div className="flex items-center gap-2 bg-white/20 px-4 py-2 rounded-full border border-white/30"><div className="w-3 h-3 bg-white rounded-full"></div> UMUM / WAJIB</div><div className="flex items-center gap-2 bg-amber-400 text-amber-950 px-4 py-2 rounded-full shadow-lg"><Icon icon={Icons.Zap} size={14} /> SPESIALISASI</div></div></div><Icon icon={Icons.Database} size={200} className="absolute -right-16 -bottom-16 opacity-10" /></div>
                                <div className="grid md:grid-cols-2 gap-8">
                                    {[1, 2, 3, 4, 5, 6, 7, 8].map(s => {
                                        const courses = CURRICULUM_DB.filter(c => c.semester === s);
                                        if (courses.length === 0) return null;
                                        return (
                                            <Card key={s} darkMode={darkMode} className="overflow-hidden border-2"><div className={`p-5 font-black text-xl flex justify-between items-center ${darkMode ? 'bg-slate-800' : 'bg-slate-50'}`}><span>Semester {s}</span><span className="opacity-30 text-sm font-bold">{courses.reduce((a,b)=>a+b.sks, 0)} SKS</span></div><div className="divide-y dark:divide-slate-800">{courses.map(c => { const spec = getSpecName(c.code); return (<div key={c.code} className={`p-5 flex justify-between items-center group transition-all ${spec ? (darkMode ? 'bg-amber-900/10' : 'bg-amber-50') : 'hover:bg-slate-50 dark:hover:bg-slate-800/20'}`}><div className="flex-1"><div className="flex items-center gap-3"><span className={`font-mono text-[10px] px-2 py-1 rounded-lg font-black transition-all ${spec ? 'bg-amber-400 text-amber-950' : 'bg-slate-100 dark:bg-slate-800 opacity-60'}`}>{c.code}</span><p className={`font-black text-sm ${spec ? 'text-amber-600' : ''}`}>{c.name}</p></div>{spec && <p className="text-[9px] mt-2 font-black text-amber-500 uppercase tracking-widest flex items-center gap-1"><Icon icon={Icons.Zap} size={10}/> Kunci Spesialisasi: {spec}</p>}</div><span className="font-black text-xs opacity-30 ml-4">{c.sks} SKS</span></div>); })}</div></Card>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* ASSISTANT */}
                        {activeTab === 'assistant' && (
                            <div className={`h-[650px] flex flex-col rounded-[40px] border-4 shadow-2xl overflow-hidden animate-in ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-white'}`}>
                                <div className="bg-indigo-600 p-6 text-white flex items-center gap-4"><div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-md border border-white/30"><Icon icon={Icons.Bot} size={28} /></div><div><h3 className="font-black text-xl">OceanAI Assistant</h3><div className="flex items-center gap-2 text-[10px] opacity-70 font-bold uppercase tracking-widest"><div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div> Gemini 2.5 Connected</div></div></div>
                                <div className={`flex-1 overflow-y-auto p-8 space-y-6 scrollbar-hide ${darkMode ? 'bg-slate-950' : 'bg-slate-50'}`}>
                                    {messages.map((m, i) => (<div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[85%] p-5 rounded-[30px] text-sm leading-relaxed font-medium shadow-sm transition-all ${m.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white dark:bg-slate-800 dark:text-slate-200 border dark:border-slate-700 rounded-tl-none'}`}>{m.text}</div></div>))}
                                    {isTyping && <div className="flex gap-2 p-4 bg-white/50 dark:bg-slate-800/50 rounded-full w-fit animate-pulse"><div className="w-2 h-2 bg-indigo-600 rounded-full animate-bounce"></div><div className="w-2 h-2 bg-indigo-600 rounded-full animate-bounce delay-100"></div><div className="w-2 h-2 bg-indigo-600 rounded-full animate-bounce delay-200"></div></div>}
                                    <div ref={chatEndRef} />
                                </div>
                                <div className="p-6 border-t flex gap-3"><input value={chatInput} onChange={(e) => setChatInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSendMessage()} className={`flex-1 p-5 border-2 rounded-[30px] focus:ring-4 focus:ring-indigo-500/20 outline-none font-bold transition-all ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white'}`} placeholder="Tanya rencana studimu..." /><button onClick={handleSendMessage} disabled={isTyping} className="bg-indigo-600 text-white p-5 rounded-[30px] shadow-xl hover:scale-110 active:scale-95 transition-all"><Icon icon={Icons.Send} size={24}/></button></div>
                            </div>
                        )}
                    </main>

                    <footer className={`p-10 border-t flex flex-col items-center gap-4 opacity-50 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>
                        <p className="text-[10px] font-black tracking-[0.2em] uppercase">OceanPlan v11 &bull; Student Support System</p>
                        <a href="mailto:aswalaritonang@gmail.com" className="flex items-center gap-2 px-4 py-2 rounded-full border border-slate-400 hover:bg-slate-900 hover:text-white transition-all text-xs font-bold"><Icon icon={Icons.Mail} size={14}/> HUBUNGI ADMIN</a>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
